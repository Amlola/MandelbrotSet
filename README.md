# Исследование эффективности SIMD-инструкций
## Описание проекта
В данном проекте было осуществлено сравнение различных алгоримтов построения множества Мандельброта (подробнее о нем ниже). А также оценка погрешности измерения времени при дополнительной нагрузке `CPU` и без нее и исследование вопроса точности измерения времени с помощью библиотеки `SFML`.
## Множество Мандельброта
Координаты точек множества Мандельброта удовлетворяют следующим уравнениям:
1) $x_{n+1}$ = $x_n^2 - y_n^2 + x_0$
2) $y_{n+1}$ = $2 * x_n * y_n + y_0$,

где (x0, y0) - координаты рассчитываемого пикселя.  

Цвет пикселя изображения зависит от количества итераций (`MAX_ITERATIONS = 256`), при которых точка находится внутри окружности данного радиуса (`MAX_RADIUS = 10`). Важно отметить, что, если точка отдалилась от центра окружности на расстояние большее, чем ее радиус, то дальше она будет удаляться в "бесконечность".

![Окно](pict/pict1.jpg)  

Таким образом, можно легко отследить области, в которых точка не вышла за пределы окружности (черный цвет) и наоборот (не черный цвет).

## Особенности и запуск программы
### Особенности
В данном проекте отлажено два режима работы:
1) **Графический режим**: открывается графическое окно размером `800x600`px, в котором визуализировано множество Мандельброта. В левом верхнем углу показывается FPS. Также поддерживается перемещение и изменение масштаба фигуры.
 
Горячие клавиши:
  
|   Клавиша   |   Действие    |
|------------:|:--------------|
| ↑           | Сдвиг вверх   |
| ↓           | Сдвиг вниз    |
| ←           | Сдвиг влево   |
| →           | Сдвиг вправо  |
| =           | Приближение   |
| -           |  Удаление     |  

2) **Тестовый режим**: запускается цикл расчета 80 кадров. Полученное значение делиться на количество итераций (80). В стандартный вывод печатается затраченное время расчета одного кадра, либо в секундах, либо в тиках процессора
в зависимости от режима измерения, выбранного пользователем.

В программе реализованы три различных метода построения данного фрактала:
  - **Naive** - обработка отдельно каждого пикселя.
  - **Array** - обработка за 1 итерацию цикла массива из 8 пикселей.
  - **Simd**  - обработка за 1 итерацию цикла 8 пикселей c использованием AVX инструкций, что позволяет добиться большей оптимизации.

### Запуск
Для того, чтобы собрать проект, нужно ввести команду:
```bash
make
```

Далее нужно вписать название `*.exe` файла и после него указать аргументы командной строки.  

Для того, чтобы запустить графическую реализацию нужно указать, какой метод построения вы хотите использовать (1 - `Naive`, 2 - `Array`, 3 - `Simd`).   

Пример запуска графической "наивной" реализации:
```bash
./mandle.exe 1  
```
  
Для того, чтобы запустить тестовую реализацию нужно указать дополнительный аргумент командной строки, который отвечает за то, в чем вы хотите получить результат (0 - `seconds`, 1 - `ticks`).  

Пример запуска тестовой "наивной" реализации с результатом в тиках процессора:
```bash
./mandle.exe 1 1
```
## Исследование производительности
### Оценка метода измерения
Измерение расчета 1 кадра мы будем получать в тактах процессора, используя функцию `__rdtsc()`. Данный метод является достаточно точным, поскольку `__rdtsc()` раскрывается в отдельную ассемблерную инструкцию (ее погрешность не превышает нескольких десятков тактов). Основную погрешность в измерения будут вносить прерывания, вызванные работой других процессов.   

Данные были получены для каждой версии алгоритма с каждым из уровней оптимизации:
 - **-O0**: оптимизация кода не производится. Исходный текст программы тривиальными преобразованиями перерабатывается в машинный код. Благодаря этому уменьшается время компиляции программы.
 - **-O3**: обычно применяются все доступные компилятору способы оптимизации.

Также были получены данные при запуске программы без применения этих флагов.  

### Обработка результатов
Для каждой серии измерений данные находятся в [таблице](results.md#результаты-измерений). Здесь будут усредненные значения, для нас они являются более важными.  

| Type\Flag       | No flags     |    -O0     |    -O3     |
|----------------:|:------------:|:----------:|:-----------|
|Naive            | 604848075    | 606626509  | 329874533  |
|Array            | 1146803707   | 1473241938 | 134850324  |
|Simd             | 210284913    | 210346435  | 53103567   |  

Для получения большего понимания визуализируем данные результаты с помощью гистограммы.
![Окно](pict/fig.png) 
### Промежуточные итоги

